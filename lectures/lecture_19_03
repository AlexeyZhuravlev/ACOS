Лекция АКОC 19.03.14

Начинаем

Сегодня переходим к изучению сетей. Тема IPC сети
Модель ISO\OSI
В реальности используется более простая, но в реальности все нaзвания привязаны именно к ней.
Когда пакет приходит он собирется нижними слоями для верхних.
...
Смена слайда
...
То есть взаимодействие происходит как горизонтальное(между машинами), так и вертикальное(в одной машине).
...
Смена слайда
...
Сперва физический уровень. Вы договариваетесь что значит что.
Затем передача фреймов. Проверяется, что передаются не абы какие биты, а проверяется длина фрейма, корректность фрейма и т.д.
Наиболее популярным является Ethernet.
Когда у нас больше, чем одна сеть, используется сетевой уровень. Определяется машрут, по которому будет идти пакет.
Обычно считают, что это путь, который затрагивает меньше всего маршутизаторов.
Следующий уровень - траспортный. Может выполнятся передача между городами. 
Огранизуется передача данных. На этом уровне есть TCP, ITP. Бывают и другие протоколы.
Транспортный уровень знает, что всё в плане маршрута организовано. Он определяет, как организовать потоки. 
Вот сетевая карта одна, а приложеий много. Разделением этих приложений занимается транспортный уровень. 
В случае траспортного протокола, бывает что соединеия нету, то есть нужно устанавливать соединение заново.
Для этого нужен сеансовый уровень. То есть когда организоать взаимодействие, или требуется делать это синхронно. 
В реальности очень сложно указать полный набор. В реальности мы используем TCP\IP, где верхние уровени отсутствует.
Уровень представления служит для того, что новые транспортные машины могут учавствовать в передачи. Происходит преобразование к единому формату.
Есть младший байт, есть старший байт. Дело в том, что в зависимости от архитектуры байты могут располагаться по разному.
Есть преобразование  hton и ntoh. Без префиксов оно работает на двухбайтовый числах, а может работать и на четырёхбайтовых. 
При посылке вызывается эта функция. В итоге пакет можно получить без ошибки.
Последний уровеь - прикладной. Например в браузере вы используете уже именно его. С этим уровнем связаны имена протоколов http и smtp. 
...
Смена слайда
...
В одной сети происходит передача на физ. уровне.
В случае двух сетей передача поисходит через сетевой уровеь.
...
Смена слайда
...
Бывают разные уровни сетевого оборудования.
Самое протое оборудование - уровень L1 - hub: То, что переходит на один порт автоматически пересылается на все остальные. 
Фактически, всё передаёся на одну шину. Все видят все пакеты. Потоки накладываются друг на друга. 
Чтобы организовать несклько потоков, нужно рассчитывать на то, что ненужные пакеты будут отвергаться
Уровень L2 - коммутатор. Здесь всё не так. Просматривает mac - адреса. 
Передача происходит по нескольким разным портам. Есть несколько виртуальных каналов. Нельзя увидеть пакеты, которые не предназачены для тебя. 
bridge может объединять порты из разных сред. Например, оптоволокно и оптическую линиую. 
Происходит запоминание адреса, фрейма, перекодирование его. Коммутатор не позволяет объединять различне среды. 
Коммутаторы вообще могут быть управляемыми и неупрвляемыми. В случае L2 вы можете заблокировать только канальный уровень. 
А отдельные IP-шнки - это уже сетевой уровень. Сделать так, чтобы с частью сети можно было работать, а с чатью нет нельзя.
Уровень L3 - маршрутизатор. Может принимать решения на уровне IP- адреса. Он работает как L2 по мак-адресам. 
Коммутатор может разве что заблокировать по мак-адресу, но тогда никакие пакеты не могут идти. 
А в случае маршрутизатора можно, например закрыть доступ только в vk. 

Перерыв

...
Смена слайда
...
По поводу протоколов и уровень. Пример
ARP - служит для того, чтобы получать mac-адрес по IP. 
Есть протокол ATA over Ethernet - когда мы можем представлять данные, расшаривать диск.
IP - реализует сетевеой адрей
...
Смена слайда
...
На самом деле все используют TCP/IP. В ней всего 4-5 уровней.
Первый уровень - канальный, физическиий. В пределах локальной сети.
Следующий уровень - межсетевой. Поять на основании айпи, понять как должен идти пакет.
Далее - транспортный. TCP - связян с некоторыми проблемами. Бывают и другие.
Все предыдущее сразу переходит на уровень приложений. 
Есть много ещё протоколов.
Всё остальное происходит над уровнями или между уровнями. 
Протокол VLAN - фактически работает сарзу после физического. Есть информация в канальном пакете. 
Пакет инкапсулируется, то есть помещается внутрь VLAN пакета. Под это отводится 12 бит. 
Их может быть 4096. Если вы поддерживаете VLAN, то вы сразу получаете пакет канального уровня. 
Если у вас есть VLAN с ID 10 и ID 20, то они не пересекаются. Всё виртуализируется.
Современные операционные системы все поддерживают эту технологию.
В противоположность этому: на канал идёт 2 айпишника. Будет один интерфейс с двумя адресами. 
В случае VLAN  - два интерфейса, возможно без адресов.
Далее- PPPoE - между канальным и сетевым уровнем. Для компьютеров, которые работают в одной Ethernet сети.
Например, ваш провайдер даёт ресурсы локальной сети, но вы должны произвести шифрование через PPPoE.
Ещё есть IPSec. Проблема: никакие данные не шифруются. Можно подсовывать пакеты, подслушивать результаты. 
IPSec обеспечивает шифрование. Встраивается он между сетевым и транспортным уровнем. 
Все остальные уровни не знают ничего про IPSec. Фактически IP, разделяется на два уровня.
SSL. Вы можете заходить по протоколу http(80) или https(443). https - протокол на основе SSL. 
Уровень SSL начинает шифровать данные, а вам даёт готовую страницу. То есть происходит на уровне представления (над транспортном уровне)
HTTP, FTP, SMTP - действуют уже на уровне приложения.
С точки зрения TCP\IP есть только уровень приложения, которое думает, как ему передавать данные.
...
Смена слайда
...
Пример про письмо. Видим html вариант и текстовый вариант. 
Передача письма - мы должны представиться, должны сказать, от кого письмо, мы должны указать адресата. 
После этого сервер скажет вам, принимает он почту или нет и даст приглашени ввести письмо. Тема и текст входят в данные письма.
Когда вы посылаете бинарные данные, почтовые сервера могут работать по TELETYPE - устройство, которое может принимать по 7 бит, а у вас 8. 
Поэтому поисходит преобразование в 64-битную кодировку. Делится всё на групы по 6 бит и кодируется.
...
Смена слайда
...
Сетевые диски. У вас есть небольшой ноутбук. А хочется иметь хранилище, к которому можно подключаться.
Вы должны иметь некоторое устройство. К нему идёт подключение по разным уровням.
На уровне диска работают протоколы AoE, ISCSI, FC - Faber Chanell 
(используются высоко-производительными системами. Использует видеокарту. 
Стэк протоколов у него рассчитан исключительно на передачу данных, нужна эффективность в передаче данных.)
На этом уровне вы сами определяете файловую систему и как с ней работать.
На уровне директорий есть протоколы NFS, SMB.
На уровне приложений вы можете предоставить доступ одному пользователю. Тут пользователю нужны логин\пароль.
...
Смена слайда
...
Сетевое взаимодействие на примере TCP\IP. 
Видим картинку. Есть устройства, есть сети. Каждая сеть смотрит в свою сетевую карту. 
У каждой сетевой карты есть твой мак-адрес, и, соответсвенно, какой-то IP-адрес.
В случае пакета, указываем IP кому и MAC и IP от кого.
В случае порта всё как-то иначе...
...
Смена слайда
...
Есть локальная ARP - таблица - соответствие между IP-адресами и MAC-адресами. 
В нашем случае машина A посылает что-то массиву B.
В случае hub-а получают все машины. В случае комутатора тоже все. 
Но на сетевом уровне машина понимает что это не её и игнорит, а нужная машина уже отправит ответный пакет. После этого формируется обычный пакет.
...
Смена слайда
...
Если мы говорим про адреса, то бывают специальные. Если в адресе все нули - это вообще все. 
Если все единицы в лок. адресе - это все только из этой сети.
MAC-адрес устроен иначе...
...
Смена слайда
...
Межсетевая передача.
Стоится таблица маршрутизация. Ищется маршрут, обсудим подробнее в следующий раз...
...
Смена слайда
...
Пример на передачу пакетов.
...
Смена слайда
...
Часто используется NAT. Есть преобразование, которое ненастоящий адрес преобразует в настоящий.
Вот машина A посылает пакет. Машина В определяет, как она должна получить этот пакет и подменяет обратный адрес. 
Если преобразование один в один, то она вообще преобразует порт в порт машины А, но портов может не хватить. Машина С получает пакет
Получаем ответ. С посылает ответ. Пересылка идёт через В, т.к. должно произойти обратное преобразование. Посылает машине А.
...
Смена слайда
...
Протокол DHCP
Вы его встретите, когда будете автоматически получать адрес. Он относится к уровню приложений. 
Вот вы включаете устройство, может оно ничего не знает о себе. Но у него есть мак-адрес. 
Оно спрашивает: кто я? Первый кто ответил, сообщает всю информацию: адрес шлюза, айпи адрес. 
Если сетевая загрзка есть, то наша машина общается с загрузочным сервером по протоколу TFTP. 
...
Смена слайда
...
ARP - атаки.
Есть такая атака, как подмена. Мы может выдать себя за некое устройство В и заставить весь трафик пропускать через себя. 
Достаточно ответить машине А, что вы машина В и забить её канал другими пакетами. 

Ох-ох, на этом всё. На следующей лекции продолжим.
